<!doctype html>

<html lang="en" class="no-js">
<head>
    <title>Open States: discover politics in your state</title>
    <script src='/js/jquery-1.7.2.js'></script>
    <script src='/js/underscore.js'></script>
    <script src='/js/highlight.js'></script>
    <script src='/js/search.js'></script>    
    <script src='templates.js'></script>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <style>
    .highlight { background-color: yellow }
    ul {list-style-type: none}
    li {border-bottom: 1px solid #EEE}
    </style>
    <script>
     $(document).ready(function() {

        var jsindex = {};
        var stemmer = new PorterStemmer();
        var body = $('body');

        $.getJSON('index.json', function(data){
            jsindex.index = data;
            });

        _.extend(jsindex, {
            query: function(w){
                console.log('getting stem_id');
                var stem_id = this.index.stem2id[w];
                console.log('getting object ids');
                var results = this.index.index[stem_id];
                objects = this.index.objects;
                console.log('getting objects');
                results = _.map(results, function(id){
                    return objects[id];
                    });
                console.log('regrouping');
                results = _.groupBy(results, function(obj){return obj._type});
                _.each(['bill', 'person', 'committee'], function(k){
                    if (results[k] == undefined){
                        results[k] = [];
                        }
                    });
                return results;
                },

            update: function(w){
                w = stemmer.stemWord(w.toLowerCase())
                var results = this.query(w);
                console.log(results);
                var content = jsonjinja.getTemplate("results").render(results);
                $('#results').html(content);
                //var tail = (jsindex.tails[w] || '');

                $('.content').highlight(w);
                }
            });

        window.jsindex = jsindex;

        var search_input = $('#search')
        search_input.bind('keyup', function(){
            var text = $(this).val();
            if (1 < text.length){
                jsindex.update(text);
                }
            else {
                $('#results').html("<p>Start typing to view data.</p>");
                }
            })
        search_input.focus();
    });
    </script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->    
</head>

<body class="home">
<input id="search" type='text'/>
<div id="results">
</div>
</body>
